package com.ssm.generator;

import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

import com.baomidou.mybatisplus.core.exceptions.MybatisPlusException;
import com.baomidou.mybatisplus.core.toolkit.StringPool;
import com.baomidou.mybatisplus.core.toolkit.StringUtils;
import com.baomidou.mybatisplus.generator.AutoGenerator;
import com.baomidou.mybatisplus.generator.InjectionConfig;
import com.baomidou.mybatisplus.generator.config.DataSourceConfig;
import com.baomidou.mybatisplus.generator.config.FileOutConfig;
import com.baomidou.mybatisplus.generator.config.GlobalConfig;
import com.baomidou.mybatisplus.generator.config.PackageConfig;
import com.baomidou.mybatisplus.generator.config.StrategyConfig;
import com.baomidou.mybatisplus.generator.config.TemplateConfig;
import com.baomidou.mybatisplus.generator.config.po.TableInfo;
import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;
import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;

public class CodeGenerator {
	 /**
	  * <p>
	  * è¯»å–æ§åˆ¶å°å†…å®?
	  * </p>
	  */
	 public static String scanner(String tip) {
	     Scanner scanner = new Scanner(System.in);
	     StringBuilder help = new StringBuilder();
	     help.append("è¯·è¾“å…?" + tip + "ï¼?");
	     System.out.println(help.toString());
	     if (scanner.hasNext()) {
	         String ipt = scanner.next();
	         if (StringUtils.isNotEmpty(ipt)) {
	             return ipt;
	         }
	     }
	     throw new MybatisPlusException("è¯·è¾“å…¥æ­£ç¡®çš„" + tip + "ï¼?");
	 }

	 public static void main(String[] args) {
	     // ä»£ç ç”Ÿæˆå™?
	     AutoGenerator mpg = new AutoGenerator();

	     // å…¨å±€é…ç½®
	     GlobalConfig gc = new GlobalConfig();
	     String projectPath = System.getProperty("user.dir");
	     gc.setOutputDir(projectPath + "/src/main/java");
	     gc.setAuthor("admin");
	     gc.setOpen(false);
	     mpg.setGlobalConfig(gc);

	     // æ•°æ®æºé…ç½?
	     DataSourceConfig dsc = new DataSourceConfig();
	     dsc.setUrl("jdbc:mysql://localhost:3306/ssm?useUnicode=true&useSSL=false&characterEncoding=utf8");
	     // dsc.setSchemaName("public");
	     dsc.setDriverName("com.mysql.jdbc.Driver");
	     dsc.setUsername("root");
	     dsc.setPassword("123");
	     mpg.setDataSource(dsc);

	     // åŒ…é…ç½?
	     PackageConfig pc = new PackageConfig();
	     pc.setModuleName(scanner("æ¨¡å—å?"));
	     pc.setParent("com.zdh");
	     mpg.setPackageInfo(pc);

	     // è‡ªå®šä¹‰é…ç½?
	     InjectionConfig cfg = new InjectionConfig() {
	         @Override
	         public void initMap() {
	             // to do nothing
	         }
	     };

	     // å¦‚æœæ¨¡æ¿å¼•æ“æ˜? freemarker
	     String templatePath = "/templates/mapper.xml.ftl";
	     // å¦‚æœæ¨¡æ¿å¼•æ“æ˜? velocity
	     // String templatePath = "/templates/mapper.xml.vm";

	     // è‡ªå®šä¹‰è¾“å‡ºé…ç½?
	     List<FileOutConfig> focList = new ArrayList<>();
	     // è‡ªå®šä¹‰é…ç½®ä¼šè¢«ä¼˜å…ˆè¾“å‡?
	     focList.add(new FileOutConfig(templatePath) {
	         @Override
	         public String outputFile(TableInfo tableInfo) {
	             // è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶å
	             return projectPath + "/src/main/resources/mapper/" + pc.getModuleName()
	                     + "/" + tableInfo.getEntityName() + "Mapper" + StringPool.DOT_XML;
	         }
	     });

	     cfg.setFileOutConfigList(focList);
	     mpg.setCfg(cfg);

	     // é…ç½®æ¨¡æ¿
	     TemplateConfig templateConfig = new TemplateConfig();

	     // é…ç½®è‡ªå®šä¹‰è¾“å‡ºæ¨¡æ?
	     // templateConfig.setEntity();
	     // templateConfig.setService();
	     // templateConfig.setController();
	     
	     templateConfig.setXml(null);
	     mpg.setTemplate(templateConfig);

	     // ç­–ç•¥é…ç½®
	     StrategyConfig strategy = new StrategyConfig();
	     strategy.setNaming(NamingStrategy.underline_to_camel);
	     strategy.setColumnNaming(NamingStrategy.underline_to_camel);
	     //strategy.setSuperEntityClass("com.baomidou.ant.common.BaseEntity");
	     //strategy.setEntityLombokModel(true);
	    // strategy.setRestControllerStyle(true);
	     //strategy.setSuperControllerClass("com.baomidou.ant.common.BaseController");
	     strategy.setInclude(scanner("è¡¨å"));
	   //  strategy.setSuperEntityColumns("id");
	     strategy.setControllerMappingHyphenStyle(true);
	     strategy.setTablePrefix(pc.getModuleName() + "_");
	     mpg.setStrategy(strategy);
	     mpg.setTemplateEngine(new FreemarkerTemplateEngine());
	     mpg.execute();
	 }

}
